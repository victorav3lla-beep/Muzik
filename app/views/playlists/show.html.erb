<div class="container py-4">
  <!-- Playlist Header with Stats -->
  <div class="card card-custom mb-4">
    <div class="card-body p-4">
      <div class="row align-items-center mb-3">
        <div class="col-md-8">
          <h1 class="mb-3"><%= @playlist.title %></h1>

          <!-- Creator Info with Followers -->
          <div class="d-flex align-items-center mb-3">
            <div class="me-3">
              <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; background: linear-gradient(135deg, #ff953d, #601fc1); border: 2px solid #ff953d;">
                <i class="fas fa-user text-white"></i>
              </div>
            </div>
            <div>
              <div class="fw-bold" style="font-size: 1.1rem;"><%= @playlist.user.email.split('@').first %></div>
              <div id="followers_counter_user_<%= @playlist.user.id %>" class="text-muted" style="font-size: 0.9rem;">
                <i class="fas fa-users me-1"></i>
                <%= @playlist.user.followers.count %> <%= @playlist.user.followers.count == 1 ? 'follower' : 'followers' %>
              </div>
            </div>
            <div class="ms-3">
              <%= bookmark_button(@playlist.user) %>
            </div>
          </div>
        </div>

        <!-- Like Button and Counter -->
        <div class="col-md-4 text-md-end">
          <div class="d-flex flex-column align-items-md-end">
            <div class="mb-2">
              <%= bookmark_button(@playlist) %>
            </div>
            <div id="likes_counter_playlist_<%= @playlist.id %>" class="badge rounded-pill" style="background: linear-gradient(135deg, #ff953d, #601fc1); padding: 0.5rem 1rem; font-size: 0.9rem;">
              <i class="fas fa-heart me-1"></i>
              <%= @playlist.bookmarks.count %> <%= @playlist.bookmarks.count == 1 ? 'like' : 'likes' %>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-3">
        <%= raw((@playlist.content)) %>
      </div>
    </div>
  </div>

<div class="row">
  <div class="col">
    <hr>
    <% video_ids = @playlist.tracks.map { |t| t.url.split("v=").last }.join(",") %>
    <h2>Tracks (<%= @playlist.tracks.count %>)</h2>
    <button class="btn btn-primary mb-3"
        onclick="document.getElementById('player').style.display = 'block'">
      ▶️ Play All Inside App
    </button>
    <div id="player" style="display:none; margin-bottom: 20px;">
      <iframe width="100%" height="360"
          src="https://www.youtube.com/embed?playlist=<%= video_ids %>&autoplay=1"
          frameborder="0"
          allowfullscreen>
      </iframe>
    </div>
    <div id="tracks" class="row g-4 mb-4">
  <% if @playlist.tracks.any? %>
    <% @playlist.tracks.each do |track| %>
      <div class="col-12 col-md-6 col-lg-4">
        <div class="track-card p-3 h-100">
          <iframe width="100%" height="180"
                  src="<%= track.url.gsub('watch?v=', 'embed/') %>"
                  title="<%= track.title %>"
                  frameborder="0"
                  allowfullscreen>
          </iframe>

          <h5 class="mt-2 mb-1"><%= track.title %></h5>
          <p class="mb-1"><strong>Artist:</strong> <%= track.artist %></p>
          <p class="mb-1"><strong>Duration:</strong> <%= track.duration %> seconds</p>

          <div class="d-flex justify-content-between">
            <%= link_to "Listen", track.url, target: "_blank", class: "btn btn-sm btn-outline-primary" %>
            <%= link_to "Delete", track_path(track), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: "btn btn-sm btn-danger" %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class="text-muted">No tracks yet. Add your first track below!</p>
  <% end %>
</div>

    <h3>Add a New Track</h3>
    <%= simple_form_for [@playlist, @track] do |f| %>
      <%= f.input :title, placeholder: "Bohemian Rhapsody" %>
      <%= f.input :artist, placeholder: "Queen" %>
      <%= f.input :url, placeholder: "https://open.youtube.com/track/..." %>
      <%= f.input :duration, hint: "Duration in seconds (e.g., 354 for 5:54)" %>
      <%= f.submit "Add Track", class: "btn btn-primary" %>
    <% end %>
  </div>
  <div class="col-md-3">
    <h2>Chats</h2>
    <div class="mb-4">
      <% if @user_playlists.present? %>
        <ul>
          <% @user_playlists.each do |playlist| %>
            <li><%= link_to playlist.title, playlist_path(playlist) %> </li>
          <% end %>
        </ul>
      <% else %>
        There are no chats yet.
      <% end %>
      <%= link_to "Create New Playlist", new_playlist_path(@chat), class: "btn btn-primary mb-3"%>
    </div>
  </div>
  <%= link_to "Back to playlists", playlists_path, class: "btn btn-outline-primary mt-3" %>
</div>
